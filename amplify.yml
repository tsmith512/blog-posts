version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yum install -y imagemagick graphicsmagick libpng-dev libwebp-dev webp
        - rvm install 2.6.5
        - rvm use 2.6.5
        - gem install bundler -v 1.17.3
        - bundle install --joobs=4 --retry=3 --path vendor/bundle
        - nvm install
        - nvm use
        - npm install -g gulp@3
        - npm install
    build:
      commands:
        - gulp build
  artifacts:
    baseDirectory: _site
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle
